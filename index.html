<!Doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Ye Old Wizard</title>
  <meta name="description" content="Ye Old Wizard">
  <meta name="viewport" content="width=device-width, initial-scale=.82, maximum-scale=1, user-scalable=no"/>
  <link rel="icon" type="image/png" href="images/favicon.ico"/>
  <link rel="stylesheet" type="text/css" href="/lib/chessground/css/chessground.base.css">
  <link rel="stylesheet" type="text/css" href="/lib/chessground/css/chessground.brown.css">
  <link rel="stylesheet" href="maestro.css">
  <link rel="stylesheet" href="chessboard.css">
  <link rel="stylesheet" href="yeoldwiz.css">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
</head>
<body>

  <div id="app" v-cloak >
    <header>
      <span> 
        <!-- @mouseover="switchNav" -->
        <span class="hamburger">☰</span> 
        <span class="main-title">Ye Old Wizard</span>
      </span>

      <span v-if="signInFailed" class="sign-in error" @click=signOut>
        <span> Failed to Sign in! </span>
        <div class="icon knight dead">♞</div>
      </span>

      <span v-else-if="user" class="sign-in">
        <span @mouseover="toggleSignOut(true)">Signed in as {{user}}</span>
        <div class="icon knight">♞</div>
        <div @mouseout="toggleSignOut(false)" v-if="shouldShowSignOut">
          <div @click="signOut" class="sign-out">Sign Out</div>
        </div>
      </span>
      
      <span v-else-if="user === null" class="sign-in">
        <span> Connecting to Lichess </span>
        <div class="icon knight spin">♞</div>
      </span>

      
      <span v-else class="sign-in">
        <a :href="signInLink">Sign In With Lichess</a>
        <div class="icon knight">♞</div>
      </span>
    </header>

    <main>
      <div class="nav-and-info" :class="{focus: infoMode !== 'browsing' || navIsOn}">
        <section v-if="!navIsOn" class="info">

          <wiz-kid-info :cmp="selected" :mode="wizKidMode" 
            @deselect="deselect" :user="user" 
            @start-game="() => startGame(selected.name)">
          </wiz-kid-info>
          
          <!-- <div>
            <img class="face" :src="'images/faces/' + selected.face" alt="selected.name">
            <h2>{{selected.name}}</h2>
            <h3>{{selected.rating}}</h3>
          </div>
          
          <div v-if="infoMode === 'selected' && user" class="buttons">
            <a class="button yellow" @click="stopSelectionLock">Cancel</a>
            <a class="button blue" @click="startGame(selected.name)">Play</a>
            <p>{{selected.style}}</p> 
          </div>

          <p v-if="infoMode === 'browsing' || infoMode === 'selected'">
            {{selected.summary}}
          </p>

          <p v-if="infoMode === 'browsing'">{{selected.bio}}</p> -->

          <span v-if="infoMode === 'error'" class="error-message" >
            <div  class="icon knight dead">♞</div>
            <h3>Error</h3>
            <p>{{errorMessage}}</p>
            <p>Please contact your Wizard Admin</p>
            <a class="button yellow" @click="clearError">Ok</a>
          </span>
          
          <div v-if="infoMode === 'selected' && user === undefined" class="buttons">
            <a :href="signInLink" class="button blue">Sign in to Play</a>
            <a class="button yellow" @click="stopSelectionLock">Cancel</a>
            <p>{{selected.style}}</p> 
          </div>
          
          <span v-if="infoMode === 'selected' && user === null" class="start-message" >
            <div>Connecting to Lichess...</div>
            <div  class="icon knight spin">♞</div>
          </span>
       
          <span v-if="infoMode === 'starting'" class="start-message" >
            <div>Starting game...</div>
            <div  class="icon knight spin">♞</div>
          </span>

          <span v-if="infoMode === 'started'" class="start-message" >
            <div>Your game has started!</div>
            <p>Click to GO TO GAME or open the Lichess app on your phone to play.</p>
            <!-- <a class="button yellow" @click="stopSelectionLock">Done</a> -->
            <a @click="openGame" class="button blue">
              Go to Game
            </a>
          </span>

          <span v-if="infoMode === 'ended'" class="start-message" >
            <h3>Game Finished</h3>
            <p>
              You have completed your game with {{selected.name}}!
              Click OK to find a new opponent
            </p>
            <a class="button yellow" @click="stopSelectionLock">OK</a>
            <!-- <a @click="openGame" class="button blue">
              Go to Game
            </a> -->
          </span>
                    
        </section>
        <nav v-if="navIsOn">
          <a v-for="group in groups" :href="'#' + group.title.replace(' ','')" @click="toggleNav">
            {{group.title}}
          </a>
          <div>
            <a class="button blue" :class="{grayed: scoreMode !== 'ladder'}" @click="switchScoreMode('ladder')">Ladder Mode</a>
            <a class="button blue" :class="{grayed: scoreMode !== 'score'}" @click="switchScoreMode('score')">Score Mode</a>
          </div>
        </nav>
      </div>
      

      <wiz-games v-if="infoMode === 'selected' && user" :cmp-name="this.selected.name">
      </wiz-games>
      <!-- <wiz-games :cmp-name="this.selected.name">
      </wiz-games> -->


      <div class="groups" :class="{noshow: infoMode !== 'browsing' && user}">
        <section v-for="group in groups" class="group"> 
          <a :name="group.title.replace(' ','')"></a>
          <h1>{{group.title}}</h1> 
          
          <div class="cmps" :class="{gms: group.isGms}">

            <div v-for="cmp of group.cmps" class="cmp-container" :title="cmp.summary">
              
              <div>
                <wiz-face 
                  :score-mode="scoreMode"
                  :score="games[cmp.name] ? games[cmp.name].score : null"
                  :is-nemesis="games[cmp.name] ? games[cmp.name].isNemesis : null"
                  :top-feat="games[cmp.name] ? games[cmp.name].topFeat : null"
                  :cmp="cmp" 
                  :selected-name="selected.name"
                  :selection-is-locked="selectionIsLocked"
                  @mouseover="showCmp(cmp)" 
                  @click="select(cmp)">
                </wiz-face>
              </div>
           
            </div>

          </div>
        </section>
      </div>
    </main>

    
  </div>

  <script src="yeoldwiz.js" type="module"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.js"></script>
</body>
</html>